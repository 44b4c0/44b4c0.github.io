---
title: "XChat рЃЊрЃћрЃЋрЃћрЃџрЃЮрЃърЃЏрЃћрЃюрЃбрЃў Part #5"
date: 2024-09-15 18:55:00 +0400
categories: [Programming]
tags: [Coding]
---


## OpenSSL рЃЊрЃљ рЃерЃўрЃцрЃарЃљрЃфрЃўрЃўрЃА рЃърЃарЃўрЃюрЃфрЃўрЃърЃћрЃЉрЃў

рЃЎрЃў, рЃЊрЃарЃЮ рЃЏрЃЮрЃЋрЃўрЃЊрЃљ `OpenSSL`-рЃўрЃА рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ рЃЏрЃЮрЃЋрЃљрЃ«рЃЊрЃўрЃюрЃЮ рЃЎрЃЮрЃЊрЃерЃў. рЃћрЃА рЃўрЃЏрЃўрЃбрЃЮрЃЏ, рЃарЃЮрЃЏ рЃљрЃа рЃЏрЃўрЃюрЃЊрЃљ рЃЋрЃўрЃюрЃЏрЃћрЃЏ рЃЏрЃљрЃарЃбрЃўрЃЋрЃў `arp spoofing` рЃерЃћрЃбрЃћрЃЋрЃўрЃЌ рЃЎрЃџрЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃЏрЃћрЃАрЃўрЃ»рЃћрЃЉрЃў рЃгрЃљрЃўрЃЎрЃўрЃЌрЃ«рЃЮрЃА. рЃљрЃЦрЃћрЃЊрЃљрЃю рЃњрЃљрЃЏрЃЮрЃЏрЃЊрЃўрЃюрЃљрЃарЃћ, рЃАрЃљрЃГрЃўрЃарЃЮрЃљ рЃбрЃарЃљрЃцрЃўрЃЎрЃўрЃА рЃерЃўрЃцрЃарЃљрЃфрЃўрЃљ. рЃЊрЃўрЃљрЃњрЃарЃљрЃЏрЃўрЃА рЃЏрЃЮрЃерЃЋрЃћрЃџрЃћрЃЉрЃљрЃф рЃерЃћрЃЏрЃўрЃФрЃџрЃўрЃљ:

```

+========+                                                                                                                                +========+
| Client |--------------------------------------------------------------------------------------------------------------------------------| Server |
+========+                                                                                                                                +========+

```

рЃЏрЃљрЃарЃбрЃўрЃЋрЃљрЃЊ рЃњрЃљрЃАрЃљрЃњрЃћрЃЉрЃўрЃљ рЃЏрЃњрЃЮрЃюрЃў рЃДрЃЋрЃћрЃџрЃљрЃцрЃћрЃарЃў. рЃЊрЃљрЃерЃўрЃцрЃарЃБрЃџрЃў рЃбрЃарЃљрЃцрЃўрЃЎрЃўрЃА рЃЊрЃарЃЮрЃА, рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА рЃбрЃБрЃюрЃћрЃџрЃў, рЃАрЃљрЃЊрЃљрЃф рЃњрЃљрЃЊрЃўрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў рЃЊрЃљ рЃљрЃЏ рЃбрЃБрЃюрЃћрЃџрЃерЃў рЃЕрЃљрЃ«рЃћрЃЊрЃЋрЃљ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃЎрЃџрЃўрЃћрЃюрЃбрЃАрЃљ рЃЊрЃљ рЃАрЃћрЃарЃЋрЃћрЃарЃА рЃерЃћрЃБрЃФрЃџрЃўрЃљрЃЌ. рЃарЃљ рЃЌрЃЦрЃЏрЃљ рЃБрЃюрЃЊрЃљ, рЃћрЃА рЃбрЃБрЃюрЃћрЃџрЃў рЃљрЃЉрЃАрЃбрЃарЃљрЃЦрЃбрЃБрЃџрЃў рЃЎрЃЮрЃюрЃфрЃћрЃцрЃфрЃўрЃљрЃљ.

> **­ЪЊЮ рЃАрЃљрЃўрЃюрЃбрЃћрЃарЃћрЃАрЃЮ рЃцрЃљрЃЦрЃбрЃў:**  
> рЃЎрЃарЃўрЃърЃбрЃЮрЃњрЃарЃљрЃцрЃўрЃљрЃерЃў рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА `рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃћрЃЉрЃўрЃА` рЃфрЃюрЃћрЃЉрЃљ. рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџ рЃ░рЃЮрЃАрЃбрЃќрЃћ(рЃЏрЃљрЃюрЃЦрЃљрЃюрЃљрЃќрЃћ) рЃњрЃћрЃюрЃћрЃарЃўрЃарЃЊрЃћрЃЉрЃљ рЃЮрЃарЃў рЃАрЃљрЃ«рЃўрЃА рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃў: `public` рЃЊрЃљ `private`(рЃљрЃюрЃБ `рЃАрЃљрЃ»рЃљрЃарЃЮ` рЃЊрЃљ `рЃЎрЃћрЃарЃФрЃЮ`). рЃарЃЮрЃЊрЃћрЃАрЃљрЃф `A` рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљрЃА `B` рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљрЃАрЃЌрЃљрЃю рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ рЃЎрЃљрЃЋрЃерЃўрЃарЃў рЃАрЃБрЃарЃА, рЃўрЃА `B` рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљрЃА рЃЌрЃљрЃЋрЃўрЃА рЃАрЃљрЃ»рЃљрЃарЃЮ рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃА рЃБрЃњрЃќрЃљрЃЋрЃюрЃўрЃА(рЃўрЃњрЃўрЃЋрЃћрЃА рЃўрЃЏрЃћрЃЮрЃарЃћрЃЉрЃА `B` рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљ `A` рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљрЃАрЃЌрЃљрЃю рЃЏрЃўрЃЏрЃљрЃарЃЌрЃћрЃЉрЃљрЃерЃў). рЃарЃЮрЃЊрЃћрЃАрЃљрЃф `B` рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљ рЃЏрЃўрЃўрЃдрЃћрЃЉрЃА `A` рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃўрЃА `public` рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃА(рЃљрЃюрЃБ `рЃАрЃљрЃ»рЃљрЃарЃЮрЃА`), рЃўрЃА `A` рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА рЃњрЃљрЃАрЃљрЃњрЃќрЃљрЃЋрЃю рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљрЃА рЃљрЃЏ рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃўрЃЌ рЃЊрЃљрЃерЃўрЃцрЃарЃљрЃЋрЃА рЃЊрЃљ рЃЕрЃЋрЃћрЃБрЃџрЃћрЃЉрЃарЃўрЃЋрЃљрЃЊ рЃњрЃљрЃБрЃњрЃќрЃљрЃЋрЃюрЃўрЃА рЃЊрЃљрЃерЃўрЃцрЃарЃБрЃџ рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљрЃА `A` рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљрЃА. рЃарЃЮрЃЊрЃћрЃАрЃљрЃф `A` рЃЏрЃЮрЃгрЃДрЃЮрЃЉрЃўрЃџрЃЮрЃЉрЃљ рЃЏрЃўрЃўрЃдрЃћрЃЉрЃА рЃЊрЃљрЃерЃўрЃцрЃарЃБрЃџ рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљрЃА, рЃўрЃА рЃЌрЃљрЃЋрЃўрЃАрЃў `private` рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃўрЃЌ(рЃљрЃюрЃБ `рЃЎрЃћрЃарЃФрЃЮ`) рЃњрЃљрЃерЃўрЃцрЃарЃљрЃЋрЃА рЃЊрЃљрЃерЃўрЃцрЃарЃБрЃџ рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљрЃА рЃЊрЃљ рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃАрЃў рЃџрЃЮрЃњрЃўрЃЎрЃўрЃАрЃЊрЃљ рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ рЃЊрЃљрЃљрЃърЃарЃЮрЃфрЃћрЃАрЃћрЃЉрЃА рЃЏрЃљрЃА(рЃњрЃљрЃљрЃЕрЃюрЃўрЃљ рЃЎрЃЮрЃЊрЃўрЃА рЃАрЃћрЃЦрЃфрЃўрЃљрЃерЃў рЃарЃљ рЃгрЃћрЃарЃўрЃљ).

рЃЎрЃЮрЃЊрЃерЃў `OpenSSL`-рЃўрЃА рЃўрЃюрЃбрЃћрЃњрЃарЃљрЃфрЃўрЃљ рЃАрЃљрЃЎрЃЏрЃљрЃЮрЃЊ рЃЏрЃљрЃарЃбрЃўрЃЋрЃўрЃљ. рЃћрЃарЃЌрЃљрЃЊрЃћрЃарЃЌрЃў рЃарЃљрЃф рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЋрЃљрЃЎрЃћрЃЌрЃЮ рЃљрЃарЃўрЃА рЃўрЃА, рЃарЃЮрЃЏ `OpenSSL`-рЃўрЃА рЃўрЃюрЃўрЃфрЃўрЃљрЃџрЃўрЃќрЃљрЃфрЃўрЃљ рЃЏрЃЮрЃЋрЃљрЃ«рЃЊрЃўрЃюрЃЮ рЃЊрЃљ рЃерЃћрЃЏрЃЊрЃћрЃњ рЃўрЃА `client_socket`-рЃА рЃЊрЃљ `server_socket`-рЃА рЃЏрЃЮрЃЋрЃЊрЃЮ(рЃЏрЃўрЃЋрЃљрЃЉрЃљ).

рЃљрЃЏрЃўрЃАрЃљрЃЌрЃЋрЃўрЃА, рЃърЃўрЃарЃЋрЃћрЃџ рЃарЃўрЃњрЃерЃў, рЃБрЃюрЃЊрЃљ рЃЊрЃљрЃЋрЃљрЃДрЃћрЃюрЃЮ `libssl-dev` рЃърЃљрЃЎрЃћрЃбрЃў рЃЊрЃљ рЃерЃћрЃЏрЃЊрЃћрЃњ рЃЎрЃЮрЃЊрЃерЃў рЃБрЃюрЃЊрЃљ рЃерЃћрЃЋрЃўрЃбрЃљрЃюрЃЮ рЃЮрЃарЃў рЃЉрЃўрЃЉрЃџрЃўрЃЮрЃЌрЃћрЃЎрЃљ:

```cpp
#include <openssl/ssl.h>
#include <openssl/err.h>
```

рЃЌрЃљрЃЋрЃЊрЃљрЃърЃўрЃарЃЋрЃћрЃџрЃљрЃЊ рЃАрЃљрЃГрЃўрЃарЃЮрЃљ `OpenSSL`-рЃўрЃА рЃўрЃюрЃўрЃфрЃўрЃљрЃџрЃўрЃќрЃљрЃфрЃўрЃљ, рЃарЃўрЃАрЃў рЃњрЃљрЃЎрЃћрЃЌрЃћрЃЉрЃљрЃф рЃерЃћрЃЏрЃЊрЃћрЃњрЃюрЃљрЃўрЃарЃљрЃЊ рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ:

```cpp
SSL_library_init();
OpenSSL_add_all_algorithms();
SSL_load_error_strings();
```

рЃърЃўрЃарЃЋрЃћрЃџрЃў рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ, рЃЉрЃўрЃЉрЃџрЃўрЃЮрЃЌрЃћрЃЎрЃўрЃА рЃўрЃюрЃўрЃфрЃўрЃљрЃџрЃўрЃќрЃљрЃфрЃўрЃљрЃА рЃћрЃЏрЃАрЃљрЃ«рЃБрЃарЃћрЃЉрЃљ, рЃЏрЃћрЃЮрЃарЃћ рЃљрЃџрЃњрЃЮрЃарЃўрЃЌрЃЏрЃў рЃЎрЃарЃўрЃърЃбрЃЮрЃњрЃарЃљрЃцрЃўрЃБрЃџ рЃљрЃџрЃњрЃЮрЃарЃўрЃЌрЃЏрЃћрЃЉрЃА рЃЕрЃљрЃбрЃЋрЃўрЃарЃЌрЃљрЃЋрЃА, рЃ«рЃЮрЃџрЃЮ рЃЉрЃЮрЃџрЃЮ рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ `Error` рЃАрЃбрЃарЃўрЃюрЃњрЃћрЃЉрЃА(рЃбрЃћрЃЦрЃАрЃбрЃћрЃЉрЃА) рЃЕрЃљрЃбрЃЋрЃўрЃарЃЌрЃљрЃЋрЃА, рЃўрЃЏрЃўрЃАрЃЌрЃЋрЃўрЃА рЃарЃЮрЃЏ `Error`-рЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў рЃЏрЃљрЃЌрЃў рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃљ рЃерЃћрЃЋрЃФрЃџрЃЮ.

рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃАрЃљрЃГрЃўрЃарЃЮрЃљ `SSL_CTX`-рЃўрЃА, рЃљрЃюрЃБ `SSL Context`-рЃўрЃА рЃЊрЃљ рЃЏрЃўрЃАрЃў рЃЏрЃћрЃЌрЃЮрЃЊрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ. рЃБрЃцрЃарЃЮ рЃАрЃгрЃЮрЃарЃљрЃЊ, `SSL Method`-рЃА рЃЊрЃљ рЃЏрЃўрЃАрЃў рЃЎрЃЮрЃюрЃбрЃћрЃЦрЃАрЃбрЃўрЃА. рЃљрЃЏ рЃДрЃЋрЃћрЃџрЃљрЃцрЃћрЃарЃА рЃљрЃАрЃћ рЃњрЃљрЃЋрЃљрЃЎрЃћрЃЌрЃћрЃЉ:

```cpp
const SSL_METHOD* ssl_method = SSLv23_client_method();
SSL_CTX *ssl_context = SSL_CTX_new(ssl_method);
```

рЃарЃЮрЃЊрЃћрЃАрЃљрЃф рЃћрЃА рЃЏрЃЮрЃ«рЃЊрЃћрЃЉрЃљ, рЃАрЃљрЃГрЃўрЃарЃЮрЃљ `ssl_context`-рЃўрЃА рЃњрЃљрЃЊрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ:

```cpp
if(!ssl_context){
	Log((char*)"Unable to initialize OpenSSL", 2);
	return 1;
}
```

рЃљрЃюрЃБ, рЃЌрЃБ `SSL`-рЃўрЃА рЃЎрЃЮрЃюрЃбрЃћрЃЦрЃАрЃбрЃўрЃА рЃўрЃюрЃўрЃфрЃўрЃљрЃџрЃўрЃќрЃћрЃЉрЃљ рЃЋрЃћрЃа рЃЏрЃЮрЃ«рЃћрЃарЃ«рЃЊрЃљ, рЃЏрЃљрЃерЃўрЃю рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљрЃА рЃЊрЃљрЃЋрЃџрЃЮрЃЎрЃљрЃЋ рЃЊрЃљ рЃърЃарЃЮрЃњрЃарЃљрЃЏрЃљрЃА рЃњрЃљрЃЋрЃљрЃЕрЃћрЃарЃћрЃЉ, рЃарЃљрЃЊрЃњрЃљрЃю рЃЊрЃљрЃБрЃерЃўрЃцрЃарЃљрЃЋрЃў рЃбрЃарЃљрЃцрЃўрЃЎрЃўрЃЌ рЃЊрЃљрЃерЃўрЃцрЃарЃБрЃџ рЃбрЃарЃљрЃцрЃўрЃЎрЃА(рЃАрЃћрЃарЃЋрЃћрЃарЃўрЃА рЃбрЃарЃљрЃцрЃўрЃЎрЃА) рЃЋрЃћрЃа рЃЏрЃўрЃБрЃћрЃарЃЌрЃЊрЃћрЃЉрЃљ рЃърЃарЃЮрЃњрЃарЃљрЃЏрЃљ.

## рЃАрЃЮрЃЎрЃћрЃбрЃўрЃА рЃерЃўрЃцрЃарЃљрЃфрЃўрЃљ

рЃљрЃЏ рЃДрЃЋрЃћрЃџрЃљрЃцрЃарЃўрЃА рЃњрЃљрЃЎрЃћрЃЌрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ, рЃерЃћрЃЏрЃўрЃФрЃџрЃўрЃљ рЃАрЃЮрЃЎрЃћрЃбрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ рЃЊрЃљ `SSL`-рЃўрЃА рЃЏрЃўрЃА рЃюрЃљрЃЎрЃљрЃЊрЃќрЃћ рЃЏрЃўрЃЏрЃљрЃњрЃарЃћрЃЉрЃљ. рЃАрЃљрЃюрЃљрЃЏ рЃљрЃЏрЃљрЃА рЃњрЃљрЃЋрЃљрЃЎрЃћрЃЌрЃћрЃЉ, рЃЏрЃГрЃўрЃарЃЊрЃћрЃЉрЃљ рЃўрЃАрЃћрЃЌрЃў рЃарЃљрЃЏ рЃарЃљрЃф рЃАрЃЮрЃЎрЃћрЃбрЃА рЃЏрЃўрЃћрЃЏрЃљрЃњрЃарЃћрЃЉрЃљ:

```cpp
SSL* ssl = SSL_new(ssl_context);
SSL_set_fd(ssl, client_socket);
```

рЃарЃљ рЃЌрЃЦрЃЏрЃљ рЃБрЃюрЃЊрЃљ, рЃЏрЃўрЃАрЃў рЃЏрЃўрЃЉрЃЏрЃўрЃА рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ рЃљрЃа рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЏрЃЮрЃЏрЃарЃЕрЃћрЃА:

```cpp
if(SSL_connect(ssl) < 0 || SSL_connect(ssl) == 0){
	Log((char*)"Unable to connect SSL to the socket's stream", 2);
	close(client_socket);
	return 1;
}
```

рЃўрЃЏ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў рЃЌрЃБ рЃћрЃАрЃћрЃф рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃљ, рЃЏрЃљрЃерЃўрЃю рЃерЃћрЃЏрЃўрЃФрЃџрЃўрЃљ рЃбрЃБрЃюрЃћрЃџрЃерЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃЕрЃљрЃДрЃарЃљ/рЃљрЃЏрЃЮрЃДрЃарЃљ рЃЊрЃљрЃЋрЃўрЃгрЃДрЃЮ. рЃљрЃюрЃБ, рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃБрЃџ `send()`/`recv()` рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃА рЃЎрЃў рЃљрЃдрЃљрЃа рЃњрЃљрЃЏрЃЮрЃЋрЃўрЃДрЃћрЃюрЃћрЃЉ, рЃљрЃарЃљрЃЏрЃћрЃЊ рЃБрЃерЃБрЃљрЃџрЃЮрЃЊ `SSL`-рЃАрЃЌрЃЋрЃўрЃА рЃњрЃљрЃюрЃЎрЃБрЃЌрЃЋрЃюрЃўрЃџ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃА рЃЕрЃљрЃЋрЃарЃЌрЃљрЃЋ рЃАрЃљрЃЦрЃЏрЃћрЃерЃў.

рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃљрЃЊ, рЃљрЃў рЃљрЃАрЃћ рЃерЃћрЃўрЃфрЃЋрЃџрЃћрЃЉрЃљ рЃЎрЃЮрЃЊрЃў:
```cpp
SSL_write(ssl, username_buffer, strlen(username_buffer));
// send(client_socket, username_buffer, USERNAME_BUFFER_SIZE, 0);
```

рЃЦрЃЋрЃћрЃЏрЃЮрЃЌ рЃарЃљрЃф рЃўрЃДрЃЮ рЃљрЃЏрЃЮрЃЋрЃљрЃЎрЃЮрЃЏрЃћрЃюрЃбрЃљрЃарЃћ рЃЊрЃљ рЃљрЃ«рЃџрЃўрЃЌ рЃЕрЃљрЃЋрЃљрЃюрЃљрЃфрЃЋрЃџрЃћ. рЃўрЃЊрЃћрЃљрЃерЃў рЃЮрЃарЃўрЃЋрЃћ рЃўрЃњрЃўрЃЋрЃћ рЃцрЃБрЃюрЃЦрЃфрЃўрЃљрЃА рЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃА, рЃЏрЃљрЃњрЃарЃљрЃЏ рЃљрЃ«рЃџрЃљ рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљ рЃЊрЃљрЃерЃўрЃцрЃарЃБрЃџрЃўрЃљ.

рЃљрЃ«рЃџрЃљ, рЃЎрЃЮрЃЏрЃърЃўрЃџрЃљрЃфрЃўрЃўрЃА рЃЊрЃарЃЮрЃА рЃљрЃАрЃћрЃЌрЃў рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃЊрЃљрЃгрЃћрЃарЃљ рЃЏрЃўрЃгрЃћрЃЋрЃА:

	g++ client.cpp -o client -pthread -lssl -lcrypto

рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃА рЃЉрЃЮрЃџрЃЮрЃА, рЃљрЃЏрЃљрЃА рЃЊрЃљрЃЋрЃљрЃЏрЃљрЃбрЃћрЃЉ, рЃарЃљрЃЌрЃљ рЃДрЃЋрЃћрЃџрЃљрЃцрЃћрЃарЃў рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃЊрЃћрЃА рЃърЃарЃЮрЃњрЃарЃљрЃЏрЃўрЃА рЃњрЃљрЃЌрЃўрЃерЃЋрЃўрЃА рЃгрЃўрЃю:

```cpp
try{
	close(client_socket);
	SSL_shutdown(ssl);
	SSL_free(ssl);
	SSL_CTX_free(ssl_context);
}
catch (...){
	SSL_shutdown(ssl);
	SSL_free(ssl);
	SSL_CTX_free(ssl_context);
}

return 0;
```

## рЃАрЃћрЃарЃЋрЃћрЃарЃўрЃА рЃЏрЃ«рЃљрЃарЃћ

рЃЊрЃарЃЮрЃљ `OpenSSL` рЃАрЃћрЃарЃЋрЃћрЃарЃќрЃћрЃф рЃљрЃЋрЃљрЃгрЃДрЃЮ, рЃарЃљрЃЊрЃњрЃљрЃю рЃЌрЃБ рЃљрЃЏрЃљрЃА рЃљрЃа рЃњрЃљрЃЋрЃљрЃЎрЃћрЃЌрЃћрЃЉ рЃЎрЃљрЃЋрЃерЃўрЃарЃў рЃљрЃа рЃерЃћрЃЊрЃњрЃћрЃЉрЃљ.

рЃАрЃћрЃарЃЋрЃћрЃарЃўрЃА рЃЏрЃ«рЃљрЃарЃћрЃА рЃБрЃЎрЃЋрЃћ рЃАрЃљрЃГрЃўрЃарЃЮрЃљ рЃњрЃљрЃАрЃљрЃдрЃћрЃЉрЃћрЃЉрЃўрЃА рЃЊрЃљрЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃљ:

	openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout server.key -out server.crt

`Runtime`-рЃерЃў рЃњрЃљрЃЋрЃбрЃћрЃАрЃбрЃћ рЃДрЃЋрЃћрЃџрЃљрЃцрЃћрЃарЃў рЃЊрЃљ рЃљрЃа рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА. рЃљрЃАрЃћ, рЃарЃЮрЃЏ рЃАрЃћрЃарЃЋрЃћрЃарЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃўрЃА рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃю рЃњрЃљрЃЊрЃљрЃгрЃћрЃарЃљ рЃЏрЃЮрЃЏрЃўрЃгрЃћрЃЋрЃА. рЃўрЃАрЃћ рЃБрЃюрЃЊрЃљ рЃњрЃљрЃЋрЃљрЃЎрЃћрЃЌрЃЮ, рЃарЃЮрЃЏ рЃњрЃљрЃарЃЎрЃЋрЃћрЃБрЃџрЃў `pointer`-рЃћрЃЉрЃўрЃА рЃљрЃ«рЃљрЃџ рЃгрЃарЃћрЃЊрЃерЃў рЃњрЃљрЃЊрЃљрЃфрЃћрЃЏрЃљ рЃљрЃдрЃљрЃа рЃЏрЃЮрЃЏрЃўрЃгрЃўрЃЮрЃА.

> **­ЪЊЮ рЃАрЃљрЃўрЃюрЃбрЃћрЃарЃћрЃАрЃЮ рЃцрЃљрЃЦрЃбрЃў:**  
> рЃДрЃЋрЃћрЃџрЃљ рЃърЃарЃЮрЃфрЃћрЃАрЃА рЃАрЃљрЃЎрЃБрЃЌрЃљрЃарЃў `virtual address space` рЃљрЃЦрЃЋрЃА. рЃљрЃАрЃћрЃЋрЃћ рЃДрЃЋрЃћрЃџрЃљ рЃгрЃарЃћрЃЊрЃА рЃњрЃљрЃЏрЃЮрЃћрЃДрЃЮрЃцрЃљ рЃАрЃљрЃЎрЃБрЃЌрЃљрЃарЃў рЃЏрЃћрЃ«рЃАрЃўрЃћрЃарЃћрЃЉрЃљ(рЃњрЃљрЃарЃЎрЃЋрЃћрЃБрЃџрЃў рЃЌрЃЋрЃљрЃџрЃАрЃљрЃќрЃарЃўрЃАрЃўрЃЌ). рЃљрЃАрЃћ, рЃарЃЮрЃЏ рЃерЃћрЃБрЃФрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ рЃћрЃарЃЌрЃў рЃгрЃарЃћрЃЊрЃўрЃЊрЃљрЃю рЃЏрЃћрЃЮрЃарЃћ рЃгрЃарЃћрЃЊрЃўрЃА рЃЏрЃћрЃ«рЃАрЃўрЃћрЃарЃћрЃЉрЃўрЃА рЃЏрЃўрЃАрЃљрЃЏрЃљрЃарЃЌрЃА(`memory address`-рЃА) рЃърЃўрЃарЃЊрЃљрЃърЃўрЃа рЃЏрЃўрЃЋрЃгрЃЋрЃЊрЃћ рЃЊрЃљ рЃЋрЃБрЃЌрЃ«рЃарЃљ CPU-рЃА, рЃарЃЮрЃЏ рЃћрЃА рЃџрЃЮрЃЎрЃљрЃфрЃўрЃљ рЃњрЃљрЃгрЃЏрЃўрЃюрЃЊрЃЮрЃА `SSL_free(ssl)` рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ.

рЃцрЃљрЃЦрЃбрЃўрЃљ, рЃАрЃћрЃарЃЋрЃћрЃарЃўрЃА рЃЎрЃЮрЃЊрЃўрЃА рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃю рЃњрЃљрЃЊрЃљрЃгрЃћрЃарЃљ рЃЊрЃљ рЃЏрЃљрЃАрЃерЃў рЃЊрЃўрЃЊрЃў рЃфрЃЋрЃџрЃўрЃџрЃћрЃЉрЃћрЃЉрЃўрЃА рЃерЃћрЃбрЃљрЃюрЃљ рЃЏрЃЮрЃЏрЃўрЃгрЃћрЃЋрЃА.

рЃЊрЃљрЃЋрЃгрЃћрЃарЃћ рЃљрЃ«рЃљрЃџрЃў `ReadFromClient()` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ:

```cpp
int ReadFromClient(int server_socket, sockaddr_in server_address, std::vector<Client> client_vector){
    SSL* ssl;
    if(client_vector.size() >= 200){
        sockaddr_in client_address;
        socklen_t szof_client_address = sizeof(client_address);
        int client_fd = accept(server_socket, reinterpret_cast<sockaddr*>(&client_address), &szof_client_address);

        if(client_fd < 0){
            Log((char*)"Unable to accept client", 2, false);
            SSL_free(ssl);
            return 1;
        }

        SSL_set_fd(ssl, client_fd);

        if(SSL_accept(ssl) <= 0){
            Log((char*)"Unable to accept SSL client", 2, false);
            SSL_free(ssl);
            return 1;
        }

        char username_buffer[USERNAME_BUFFER_SIZE];

        int received_bytes = SSL_read(ssl, username_buffer, USERNAME_BUFFER_SIZE - 1);

        if(received_bytes < 0){
            Log((char*)"Unable to receive nickname from SSL client", 2, false);
            close(client_fd);
            SSL_free(ssl);
            return 1;
        }
        else if(received_bytes == 0){
            Log((char*)"SSL Client disconnected", 1, false);
            close(client_fd);
            SSL_free(ssl);
            return 1;
        }
        else{
            username_buffer[received_bytes] = '\0';
            char data_send_buffer[SPEC_CODE_BUFFER_SIZE];

            sprintf(data_send_buffer, "%s", SERVER_FULL_SPEC_CODE);
            SSL_write(ssl, data_send_buffer, SPEC_CODE_BUFFER_SIZE);
            close(client_fd);
            SSL_free(ssl);
            return 1;
        }
    }
    else{
        sockaddr_in client_address;
        socklen_t szof_client_address = sizeof(client_address);
        int client_fd = accept(server_socket, reinterpret_cast<sockaddr*>(&client_address), &szof_client_address);

        SSL_set_fd(ssl, client_fd);

        if(SSL_accept(ssl) <= 0){
            Log((char*)"Unable to accept SSL client", 2, false);
            close(client_fd);
            SSL_free(ssl);
            return 1;
        }

        char username_buffer[USERNAME_BUFFER_SIZE];

        int received_bytes = SSL_read(ssl, username_buffer, USERNAME_BUFFER_SIZE - 1);

        if(received_bytes < 0){
            Log((char*)"Unable to receive username from SSL client", 2, false);
            close(client_fd);
            SSL_free(ssl);
            return 1;
        }
        else if(received_bytes == 0){
            Log((char*)"SSL client disconnected", 2, false);
            close(client_fd);
            SSL_free(ssl);
            return 1;
        }
        else{
            Client new_client;
            new_client.client_fd = client_fd;
            new_client.username = username_buffer;
            new_client.ip_address = inet_ntoa(client_address.sin_addr);
            new_client.port = ntohs(client_address.sin_port);
            new_client.ssl = ssl;

            client_vector.push_back(new_client);

            while(true == true){
                char message_buffer[MESSAGE_BUFFER_SIZE];
                int received_bytes = SSL_read(ssl, message_buffer, MESSAGE_BUFFER_SIZE - 1);
                if(received_bytes < 0){
                    Log((char*)"Unable to receive message from SSL client", 2, false);
                    close(client_fd);
                    SSL_free(ssl);
                    RemoveClient(client_vector, client_fd);
                    return 1;
                }
                else if(received_bytes == 0){
                    Log((char*)"SSL client disconnected", 1, false);
                    close(client_fd);
                    SSL_free(ssl);
                    RemoveClient(client_vector, client_fd);
                    return 1;
                }
                else{
                    if(strcmp(message_buffer, CLIENT_EXIT)){
                        RemoveClient(client_vector, client_fd);
                        char data[MESSAGE_BUFFER_SIZE];
                        sprintf(data, "%s Disconnected", new_client.username);
                        for(const auto &client : client_vector){
                            if(client.ssl != ssl){
                                SSL_write(client.ssl, data, strlen(data));
                            }
                        }
                        return 1;
                    }
                    for(const auto &client : client_vector){
                        if(client.ssl != ssl){
                            SSL_write(client.ssl, message_buffer, MESSAGE_BUFFER_SIZE);
                        }
                    }
                }
            }
        }
    }

    

    return 0;
}
```

рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљ рЃўрЃАрЃћрЃЋ рЃгрЃарЃћрЃЊрЃћрЃЉрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљрЃљ.
